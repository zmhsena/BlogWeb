<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ç®¡ç†åå° - Sena's blog</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); }

        /* Token è¾“å…¥åŒºåŸŸæ ·å¼ */
        .token-section { background: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 20px; border: 1px dashed #cbd5e0; }
        .token-section h4 { margin-top: 0; color: #2d3748; }
        .token-input-group { display: flex; gap: 10px; align-items: center; }
        #token-input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; }

        .post-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; align-items: center; }
        .edit-area { margin-top: 30px; padding-top: 20px; border-top: 2px solid #2c3e50; }
        input, textarea { width: 100%; margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background: #2c3e50; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        button.delete { background: #e74c3c; margin-left: 5px; }
        .status-msg { font-size: 0.9rem; margin-top: 10px; color: #3182ce; }
    </style>
</head>
<body>
<div class="admin-container">
    <h2>åšå®¢åå°ç®¡ç†</h2>

    <div class="token-section">
        <h4>ğŸ”‘ èº«ä»½éªŒè¯ (GitHub Token)</h4>
        <div class="token-input-group">
            <input type="password" id="token-input" placeholder="ghp_xxxxxxxxxxxx">
            <button onclick="saveTokenToLocal()" style="background: #4a5568;">ä¿å­˜åˆ°æœ¬åœ°</button>
            <button onclick="clearToken()" style="background: #a0aec0;">æ¸…é™¤</button>
        </div>
        <p style="font-size: 0.8rem; color: #718096; margin-top: 5px;">Token ä»…ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ è‡³ä»£ç åº“ã€‚</p>
    </div>

<!--    <div id="admin-post-list"></div>-->
    <div class="admin-main">
        <div class="list-section">
            <h3>å·²æœ‰æ–‡ç« åˆ—è¡¨</h3>
            <div id="admin-post-list" class="scroll-window">
            </div>
        </div>

        <div class="edit-section">
        </div>
    </div>

    <div class="edit-area">
        <h3 id="form-title">æ’°å†™æ–°æ–‡ç« </h3>
        <input type="hidden" id="edit-index" value="-1">

        <div class="toolbar">
            <button type="button" onclick="insertFormat('bold')"><b>B</b></button>
            <button type="button" onclick="insertFormat('italic')"><i>I</i></button>

            <div class="color-dropdown">
                <button type="button">ğŸ¨ é¢œè‰² â–¼</button>
                <div class="color-menu">
                    <div class="color-option" style="background: #e74c3c" onclick="insertFormat('color', '#e74c3c')"></div>
                    <div class="color-option" style="background: #3498db" onclick="insertFormat('color', '#3498db')"></div>
                    <div class="color-option" style="background: #2ecc71" onclick="insertFormat('color', '#2ecc71')"></div>
                    <div class="color-option" style="background: #f1c40f" onclick="insertFormat('color', '#f1c40f')"></div>
                    <div class="color-option" style="background: #9b59b6" onclick="insertFormat('color', '#9b59b6')"></div>
                </div>
            </div>

            <button type="button" onclick="insertFormat('highlight')">âœ¨ å¼ºè°ƒ</button>
            <button type="button" onclick="insertFormat('image')">ğŸ–¼ å›¾ç‰‡</button>
        </div>

        <div class="editor-container">
            <div class="editor-input">
                <input type="text" id="post-title" placeholder="æ–‡ç« æ ‡é¢˜" oninput="updatePreview()">
                <input type="text" id="post-category" placeholder="åˆ†ç±»" oninput="updatePreview()">
                <textarea id="post-content" rows="15" placeholder="åœ¨æ­¤è¾“å…¥å†…å®¹..." oninput="updatePreview()"></textarea>
            </div>
            <div class="editor-preview">
                <div class="preview-label">å®æ—¶é¢„è§ˆ</div>
                <div id="live-preview" class="markdown-body"></div>
            </div>
        </div>

        <button id="submit-btn" onclick="savePost()">ğŸš€ å‘å¸ƒå¹¶åŒæ­¥åˆ° GitHub</button>
        <button onclick="resetForm()" style="background:#95a5a6">å–æ¶ˆä¿®æ”¹</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</div>

<!--<script src="data.js"></script>-->
<script src="githubService.js"></script>
<script>
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¯»å–æœ¬åœ°ä¿å­˜çš„ Token
    // åœ¨ admin.html çš„ <script> å—å¼€å¤´

    // 1. åˆå§‹åŒ–æ—¶å…ˆä»äº‘ç«¯æ‹‰å–æ•°æ®
    window.onload = async function() {
        console.log("æ­£åœ¨è·å–äº‘ç«¯æœ€æ–°æ•°æ®...");
        await fetchLatestDataFromCloud();
        renderAdminPosts(); // æ•°æ®æ‹¿åˆ°åå†æ¸²æŸ“åˆ—è¡¨
        initDragAndDrop()
    };

    async function fetchLatestDataFromCloud() {
        const branch = GITHUB_CONFIG.branch;
        const repo = GITHUB_CONFIG.repo;
        const url = `https://api.github.com/repos/${repo}/contents/data.js?ref=${branch}&t=${Date.now()}`;

        try {
            const res = await fetch(url);
            if (!res.ok) throw new Error("æ— æ³•è¿æ¥ GitHub");
            const json = await res.json();

            // è§£ç å¹¶æ‰§è¡Œï¼Œè¿™æ · window.blogPosts å°±å˜æˆäº†äº‘ç«¯çš„æœ€æ–°å†…å®¹
            const contentStr = decodeURIComponent(escape(atob(json.content)));
            const scriptEval = document.createElement('script');
            scriptEval.text = contentStr;
            document.head.appendChild(scriptEval);

            console.log("äº‘ç«¯æ•°æ®åŒæ­¥å®Œæˆï¼å½“å‰æ–‡ç« æ•°:", window.blogPosts.length);
        } catch (e) {
            console.error("åŒæ­¥å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°/ç©ºæ•°æ®:", e);
            if (!window.blogPosts) window.blogPosts = [];
        }
    }

    // 2. ä¿®æ”¹åŸæœ‰çš„æ¸²æŸ“å‡½æ•°åï¼ˆé¿å…å’Œ script.js å†²çªæˆ–ä¿æŒé€»è¾‘æ¸…æ™°ï¼‰
    function renderAdminPosts() {
        const list = document.getElementById('admin-post-list');
        if (!window.blogPosts) return;

        list.innerHTML = window.blogPosts.map((post, index) => `
        <div class="post-item">
            <span>${post.title} (${post.date})</span>
            <div>
                <button onclick="editPost(${index})" style="background:#4a90e2; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ç¼–è¾‘</button>
                <button onclick="deletePost(${index})" style="background:#e74c3c; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer; margin-left:5px;">åˆ é™¤</button>
            </div>
        </div>
    `).join('');
    }

    function saveTokenToLocal() {
        const val = document.getElementById('token-input').value;
        if (val) {
            localStorage.setItem('my_gh_token', val);
            alert('Token å·²åŠ å¯†ä¿å­˜è‡³æœ¬åœ°æµè§ˆå™¨å­˜å‚¨');
        }
    }

    function clearToken() {
        localStorage.removeItem('my_gh_token');
        document.getElementById('token-input').value = '';
        alert('æœ¬åœ° Token å·²æ¸…é™¤');
    }

    function renderAdminList() {
        const listContainer = document.getElementById('admin-post-list');
        if (!listContainer) return;

        // 1. ã€æ ¸å¿ƒä¿®å¤ã€‘åœ¨æ­¤å¤„å®šä¹‰ html å˜é‡ï¼Œåˆå§‹ä¸ºç©ºå­—ç¬¦ä¸²
        let html = '';

        // 2. æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®
        if (!window.blogPosts || window.blogPosts.length === 0) {
            listContainer.innerHTML = '<div style="padding:20px; color:#999;">æš‚æ— æ–‡ç« ï¼Œå¼€å§‹æ’°å†™ç¬¬ä¸€ç¯‡å§ï¼</div>';
            return;
        }

        // 3. éå†æ•°æ®ç”Ÿæˆ HTML å­—ç¬¦ä¸²
        window.blogPosts.forEach((post, index) => {
            html += `
            <div class="admin-item">
                <div style="display:flex; flex-direction:column; max-width:70%;">
                    <span style="font-weight:bold; color:#2c3e50;">${post.title}</span>
                    <small style="color:#999;">${post.date} | ${post.category}</small>
                </div>
                <div class="admin-btns">
                    <button onclick="editPost(${index})" style="background:#3498db; margin-right:5px;">ä¿®æ”¹</button>
                    <button onclick="deletePost(${index})" style="background:#e74c3c;">åˆ é™¤</button>
                </div>
            </div>
        `;
        });

        // 4. å°†æ‹¼æ¥å¥½çš„ HTML ä¸€æ¬¡æ€§æ¸²æŸ“åˆ°å®¹å™¨ä¸­
        listContainer.innerHTML = html;
    }
    // åœ¨ admin.html çš„ <script> é¡¶éƒ¨æ·»åŠ 
    let pendingImages = []; // ç”¨äºå­˜æ”¾å¾…ä¸Šä¼ çš„å›¾ç‰‡å¯¹è±¡ {name, base64}

    // åˆå§‹åŒ–æ‹–æ‹½äº‹ä»¶
    function initDragAndDrop() {
        const textarea = document.getElementById('post-content');

        textarea.addEventListener('dragover', (e) => {
            e.preventDefault();
            textarea.style.borderColor = '#3498db'; // æ‹–å…¥æ—¶é«˜äº®è¾¹æ¡†
        });

        textarea.addEventListener('dragleave', () => {
            textarea.style.borderColor = '#ddd';
        });

        textarea.addEventListener('drop', async (e) => {
            e.preventDefault();
            textarea.style.borderColor = '#ddd';

            const files = e.dataTransfer.files;
            for (let file of files) {
                if (file.type.startsWith('image/')) {
                    await processImage(file);
                }
            }
        });
    }

    // å¤„ç†å›¾ç‰‡æ–‡ä»¶
    // admin.html ä¸­çš„ processImage å‡½æ•°
    // ä¿®æ”¹ admin.html ä¸­çš„å›¾ç‰‡å¤„ç†é€»è¾‘
    async function processImage(file) {
        const textarea = document.getElementById('post-content');
        const token = document.getElementById('token-input').value;
        // åœ¨ admin.html çš„ processImage å‡½æ•°é‡Œ
        const originalName = file.name;
// å°†ç©ºæ ¼æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œç§»é™¤ç‰¹æ®Šå­—ç¬¦
        const fileName = originalName.replace(/\s+/g, '_').replace(/[()ï¼ˆï¼‰]/g, '');

// ä¹‹åå†ä½¿ç”¨è¿™ä¸ª safeName è¿›è¡Œä¸Šä¼ å’Œ Markdown æ’å…¥
        const path = `images/${fileName}`;

        // 1. æ£€æŸ¥ GitHub è¿œç¨‹æ˜¯å¦å·²å­˜åœ¨åŒåå›¾ç‰‡
        const url = `https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/${path}?ref=${GITHUB_CONFIG.branch}`;

        try {
            const checkRes = await fetch(url, {
                headers: { "Authorization": `token ${token}` }
            });

            if (checkRes.ok) {
                // å›¾ç‰‡å·²å­˜åœ¨ï¼Œç›´æ¥æ’å…¥ Markdownï¼Œè·³è¿‡ä¸Šä¼ æ­¥éª¤
                console.log("å›¾ç‰‡å·²å­˜åœ¨ï¼Œç›´æ¥å¼•ç”¨:", fileName);
                insertImageMarkdown(textarea, fileName);
                return;
            }
        } catch (e) { /* å¿½ç•¥é”™è¯¯ï¼Œç»§ç»­ä¸Šä¼ æµç¨‹ */ }

        // 2. å›¾ç‰‡ä¸å­˜åœ¨ï¼Œè¯»å–å¹¶åŠ å…¥å¾…ä¸Šä¼ é˜Ÿåˆ—
        const reader = new FileReader();
        reader.onload = (e) => {
            pendingImages.push({
                name: fileName,
                content: e.target.result.split(',')[1],
                localUrl: e.target.result
            });
            insertImageMarkdown(textarea, fileName);
        };
        reader.readAsDataURL(file);
    }

    function insertImageMarkdown(textarea, fileName) {
        const imgMarkdown = `![${fileName}](images/${fileName})`;
        const start = textarea.selectionStart;
        textarea.value = textarea.value.substring(0, start) + imgMarkdown + textarea.value.substring(textarea.selectionEnd);
        updatePreview();
    }
    
    // ... å…¶ä½™ editPost, deletePost, resetForm é€»è¾‘ä¿æŒä¸å˜ ...
    // (çœç•¥éƒ¨åˆ†ä¸ä¹‹å‰ç›¸åŒä»¥ä¿æŒç®€æ´)

    function editPost(index) {
        const post = window.blogPosts[index];
        document.getElementById('edit-index').value = index;
        document.getElementById('post-title').value = post.title;
        document.getElementById('post-category').value = post.category;
        document.getElementById('post-content').value = post.fullContent;
        document.getElementById('form-title').innerText = "ç¼–è¾‘æ–‡ç« ";
        window.scrollTo(0, document.body.scrollHeight);
    }
    // åŠ¨æ€ç”ŸæˆåŸºç¡€ URL
    function getRawBaseUrl() {
        // ä½¿ç”¨ GITHUB_CONFIG ä¸­å®šä¹‰çš„åˆ†æ”¯å
        const branch = GITHUB_CONFIG.branch || 'master';
        return `https://raw.githubusercontent.com/${GITHUB_CONFIG.repo}/${branch}/`;
    }

    // åœ¨ updatePreview ä¸­ä½¿ç”¨
    function updatePreview() {
        let content = document.getElementById('post-content').value;
        const rawBaseUrl = getRawRoot();

        // å…ˆç”¨å†…å­˜ä¸­çš„ Base64 æ›¿æ¢ï¼ˆè§£å†³åˆšæ‹–å…¥æœªä¸Šä¼ çš„é¢„è§ˆï¼‰
        pendingImages.forEach(img => {
            content = content.split(`images/${img.name}`).join(img.localUrl);
        });

        // å†å°†å…¶ä»–çš„ç›¸å¯¹è·¯å¾„æŒ‡å‘å½“å‰å¼€å‘åˆ†æ”¯çš„è¿œç¨‹åœ°å€
        content = content.replace(/\(images\//g, `(${rawBaseUrl}images/`);

        document.getElementById('live-preview').innerHTML = marked.parse(content);
    }

    // ä¼˜åŒ–çš„æ ¼å¼æ’å…¥å‡½æ•°
    function insertFormat(type, colorValue = null) {
        const textarea = document.getElementById('post-content');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selectedText = textarea.value.substring(start, end);
        let newText = "";

        switch (type) {
            case 'bold': newText = `**${selectedText || "ç²—ä½“"}**`; break;
            case 'italic': newText = `*${selectedText || "æ–œä½“"}*`; break;
            case 'color':
                newText = `<span style="color:${colorValue}">${selectedText || "å½©è‰²æ–‡å­—"}</span>`;
                break;
            case 'highlight': newText = `<mark>${selectedText || "å¼ºè°ƒ"}</mark>`; break;
            case 'image':
                const url = prompt("å›¾ç‰‡é“¾æ¥:");
                if(url) newText = `![æè¿°](${url})`;
                break;
        }

        const content = textarea.value;
        textarea.value = content.substring(0, start) + newText + content.substring(end);

        // æ’å…¥åç«‹å³æ›´æ–°é¢„è§ˆ
        updatePreview();

        textarea.focus();
        textarea.setSelectionRange(start + newText.length, start + newText.length);
    }

    // é¡µé¢åŠ è½½ååˆå§‹åŒ–ä¸€ä¸‹é¢„è§ˆ
    window.addEventListener('DOMContentLoaded', updatePreview);

    // ä¿®æ”¹ admin.html ä¸­çš„ savePost å‡½æ•°
    async function savePost() {
        const token = document.getElementById('token-input').value;
        const btn = document.getElementById('submit-btn');
        if (!token) return alert("è¯·å…ˆè¾“å…¥å¹¶ä¿å­˜ Token");

        btn.disabled = true;
        btn.innerText = "æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...";

        try {
            // 1. ç›´æ¥å¾ªç¯ä¸Šä¼ å›¾ç‰‡ï¼Œè·¯å¾„å·²ç»ä¸æ­£æ–‡ä¸€è‡´
            for (let img of pendingImages) {
                await uploadFileToGitHub(`images/${img.name}`, img.content, token);
            }

            // 2. ç›´æ¥è·å–æ­£æ–‡ï¼Œæ­¤æ—¶é‡Œé¢å·²ç»æ˜¯ ![alt](images/filename)
            const finalContent = document.getElementById('post-content').value;

            const newPost = {
                title: document.getElementById('post-title').value,
                date: new Date().toISOString().split('T')[0],
                excerpt: finalContent.substring(0, 100).replace(/[#*`\n]/g, '') + "...",
                fullContent: finalContent,
                category: document.getElementById('post-category').value || "æœªåˆ†ç±»"
            };

            // 3. åŒæ­¥åˆ° data.js
            const editIndex = parseInt(document.getElementById('edit-index').value);
            let updatedPosts = [...window.blogPosts];

            if (editIndex === -1) {
                updatedPosts.unshift(newPost);
            } else {
                updatedPosts[editIndex] = newPost;
            }

            const success = await syncToGitHub(updatedPosts, token);
            if (success) {
                alert("åŒæ­¥æˆåŠŸï¼");
                pendingImages = []; // æ¸…ç©ºå¾…ä¸Šä¼ åˆ—è¡¨
                location.reload();
            }
        } catch (err) {
            alert("ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°");
            console.error(err);
        } finally {
            btn.disabled = false;
            btn.innerText = "ğŸš€ å‘å¸ƒå¹¶åŒæ­¥åˆ° GitHub";
        }
    }

    // é€šç”¨çš„å•æ–‡ä»¶ä¸Šä¼ å‡½æ•°
    async function uploadFileToGitHub(path, base64Content, token) {
        const url = `https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/${path}`;
        const res = await fetch(url, {
            method: "PUT",
            headers: {
                "Authorization": `token ${token}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                message: `Upload image: ${path}`,
                content: base64Content,
                branch: GITHUB_CONFIG.branch
            })
        });
        return res.ok;
    }

    // åŒæ­¥æ•°æ®åˆ° GitHub çš„æ ¸å¿ƒå‡½æ•°
    async function syncToGitHub(updatedPosts, token) {
        const url = `https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`;

        // 1. è·å–æœ€æ–° SHAï¼Œå¸¦ä¸Šæ—¶é—´æˆ³é˜²æ­¢è¯»å–ç¼“å­˜ SHA å¯¼è‡´å†²çª
        const getRes = await fetch(`${url}?ref=${GITHUB_CONFIG.branch}&t=${Date.now()}`, {
            headers: { "Authorization": `token ${token}` }
        });
        const fileData = await getRes.json();

        // 2. å‡†å¤‡æ–°å†…å®¹ï¼ˆä¿ç•™æ¢è¡Œç¬¦ \nï¼‰
        const newFileContent = `window.blogPosts = ${JSON.stringify(updatedPosts, null, 2)};`;

        // 3. PUT è¯·æ±‚æäº¤æ›´æ–°
        const putRes = await fetch(url, {
            method: "PUT",
            headers: {
                "Authorization": `token ${token}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                message: `Admin update: ${new Date().toLocaleString()}`,
                content: btoa(unescape(encodeURIComponent(newFileContent))), // å®Œç¾æ”¯æŒä¸­æ–‡
                sha: fileData.sha,
                branch: GITHUB_CONFIG.branch
            })
        });

        return putRes.ok;
    }

    // åˆ é™¤æ–‡ç« å‡½æ•°
    // ä¿®æ”¹ admin.html ä¸­çš„åˆ é™¤å‡½æ•°
    async function deletePost(index) {
        const token = document.getElementById('token-input').value;
        if(!token) return alert("è¯·è¾“å…¥ Token");

        if(!confirm("ç¡®å®šåˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿæ¸…ç†æœªä½¿ç”¨çš„å›¾ç‰‡å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´ã€‚")) return;

        const allPosts = window.blogPosts;
        const targetPost = allPosts[index];
        const otherPosts = allPosts.filter((_, i) => i !== index);

        // 1. æå–ç›®æ ‡æ–‡ç« ä¸­å¼•ç”¨çš„æ‰€æœ‰å›¾ç‰‡å
        const targetImages = extractImageNames(targetPost.fullContent);

        // 2. æå–æ‰€æœ‰å…¶ä»–æ–‡ç« å¼•ç”¨çš„å›¾ç‰‡åé›†åˆ
        const otherImagesSet = new Set();
        otherPosts.forEach(p => {
            extractImageNames(p.fullContent).forEach(img => otherImagesSet.add(img));
        });

        // 3. æ‰¾å‡ºâ€œå­¤ç«‹â€å›¾ç‰‡ï¼šåªåœ¨ç›®æ ‡æ–‡ç« ä¸­å‡ºç°ï¼Œæ²¡åœ¨å…¶ä»–æ–‡ç« å‡ºç°çš„
        const imagesToDelete = targetImages.filter(img => !otherImagesSet.has(img));

        // 4. æ‰§è¡Œåˆ é™¤å›¾ç‰‡æ“ä½œ
        for (const imgName of imagesToDelete) {
            await deleteFileFromGitHub(`images/${imgName}`, token);
        }

        // 5. æ›´æ–° data.js
        const newPosts = [...otherPosts];
        const success = await syncToGitHub(newPosts, token);

        if(success) {
            alert("æ–‡ç« åŠå†—ä½™å›¾ç‰‡å·²æ¸…ç†æˆåŠŸï¼");
            location.reload();
        }
    }

    // è¾…åŠ©å·¥å…·ï¼šä» Markdown æ–‡æœ¬ä¸­æ­£åˆ™åŒ¹é… images/xxx.png
    function extractImageNames(content) {
        const regex = /images\/([^\)\s]+)/g;
        const names = [];
        let match;
        while ((match = regex.exec(content)) !== null) {
            names.push(match[1]);
        }
        return names;
    }

    // è¾…åŠ©å·¥å…·ï¼šè°ƒç”¨ GitHub API åˆ é™¤æ–‡ä»¶
    async function deleteFileFromGitHub(path, token) {
        const url = `https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/${path}?ref=${GITHUB_CONFIG.branch}`;

        try {
            const getRes = await fetch(url, { headers: { "Authorization": `token ${token}` } });
            if (!getRes.ok) return;
            const fileData = await getRes.json();

            await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/${path}`, {
                method: "DELETE",
                headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    message: `Delete orphan image: ${path}`,
                    sha: fileData.sha,
                    branch: GITHUB_CONFIG.branch
                })
            });
            console.log("å·²æ¸…ç†å­¤ç«‹å›¾ç‰‡:", path);
        } catch (e) { console.error("åˆ é™¤å›¾ç‰‡å¤±è´¥:", path, e); }
    }

    function resetForm() {
        document.getElementById('edit-index').value = "-1";
        document.getElementById('post-title').value = "";
        document.getElementById('post-category').value = "";
        document.getElementById('post-content').value = "";
        document.getElementById('form-title').innerText = "æ’°å†™æ–°æ–‡ç« ";
    }
</script>
</body>
</html>